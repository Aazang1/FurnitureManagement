<Page x:Class="FurnitureManagement.Client.Views.PurchaseManagementPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:FurnitureManagement.Client.Views"
      xmlns:models="clr-namespace:FurnitureManagement.Client.Models"
      xmlns:converters="clr-namespace:FurnitureManagement.Client.Converters"
      mc:Ignorable="d"
      d:DesignHeight="800"
      d:DesignWidth="1000"
      Title="采购管理"
      Background="#F5F5F5">

    <Grid>
        <!-- 添加转换器资源 -->
        <Grid.Resources>
            <converters:StatusToChineseConverter x:Key="StatusConverter"/>
        </Grid.Resources>

        <!-- 顶部标题栏 -->
        <Border Background="White" Height="60" VerticalAlignment="Top" BorderThickness="0,0,0,1" BorderBrush="#E0E0E0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 页面标题 -->
                <TextBlock Text="采购管理" FontSize="20" FontWeight="Bold" Foreground="#333333" 
                           VerticalAlignment="Center" Margin="20,0,0,0"/>

                <!-- 右上角操作区域 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,20,0">
                    <!-- 创建采购订单按钮 -->
                    <Button x:Name="btnCreateOrder" 
                            Content="创建采购订单" 
                            FontSize="14" 
                            Padding="15,8"
                            MinWidth="120"
                            Background="#409EFF" 
                            Foreground="White"
                            BorderBrush="Transparent" 
                            BorderThickness="0" 
                            Click="btnCreateOrder_Click"
                            Margin="0,0,10,0">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Cursor" Value="Hand"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="border"
                                                    Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="4"
                                                    SnapsToDevicePixels="True">
                                                <ContentPresenter x:Name="contentPresenter"
                                                                  HorizontalAlignment="Center"
                                                                  VerticalAlignment="Center"
                                                                  RecognizesAccessKey="True"
                                                                  SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                                                  Margin="{TemplateBinding Padding}"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#66B1FF"/>
                                                    <Setter Property="Cursor" Value="Hand"/>
                                                </Trigger>
                                                <Trigger Property="IsPressed" Value="True">
                                                    <Setter TargetName="border" Property="Background" Value="#3A8BE5"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- 内容区域 -->
        <Grid Margin="20,80,20,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 查询区域 -->
            <Border Background="White" CornerRadius="8" Padding="20" BorderBrush="#E0E0E0" BorderThickness="1" 
                    Margin="0,0,0,20" Grid.Row="0">
                <StackPanel>
                    <!-- 按日期查询 -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <TextBlock Text="按日期查询:" FontSize="14" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <DatePicker x:Name="dpFromDate" Width="161" Height="35" VerticalContentAlignment="Center" FontSize="14" Padding="8,6"/>
                        <TextBlock Text="到" VerticalAlignment="Center" Margin="10,0,10,0" FontSize="14"/>
                        <DatePicker x:Name="dpToDate" Width="158" Height="35" VerticalContentAlignment="Center" FontSize="14" Padding="8,6"/>
                        <Button x:Name="btnFilterByDate" Content="查询" FontSize="14" Padding="12,8" 
                                Background="#409EFF" Foreground="White" Cursor="Hand"
                                BorderBrush="Transparent" BorderThickness="0" Click="btnFilterByDate_Click" 
                                RenderTransformOrigin="1.991,0.554" Width="78" Height="35" Margin="10,0,10,0">
                            <Button.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform/>
                                    <SkewTransform/>
                                    <RotateTransform Angle="-0.448"/>
                                    <TranslateTransform X="0.021" Y="-0.326"/>
                                </TransformGroup>
                            </Button.RenderTransform>
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type Button}">
                                                <Border x:Name="border"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#66B1FF"/>
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                        <Button Content="重置" FontSize="14" Padding="12,8" 
                                Background="#E0E0E0" Foreground="#333333" Cursor="Hand"
                                BorderBrush="Transparent" BorderThickness="0" Click="btnResetFilter_Click" 
                                Width="84" RenderTransformOrigin="0.984,0.601" Height="35" Margin="0,0,0,0">
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="{x:Type Button}">
                                                <Border x:Name="border"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>

                    <!-- 按供应商查询 -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <TextBlock Text="按供应商查询:" FontSize="14" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <ComboBox x:Name="cmbSupplier" Width="200" Height="30" VerticalContentAlignment="Center" FontSize="14"/>
                        <Button x:Name="btnSearchBySupplier" Content="查询" FontSize="14" Padding="12,8" Margin="10,0,0,0" 
                                Background="#409EFF" Foreground="White" Cursor="Hand"
                                BorderBrush="Transparent" BorderThickness="0" Click="btnSearchBySupplier_Click" Width="70">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="border"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#66B1FF"/>
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>

                    <!-- 按商品查询 -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="按商品查询:" FontSize="14" Margin="0,0,10,0" VerticalAlignment="Center"/>
                        <ComboBox x:Name="cmbFurniture" Width="200" Height="30" VerticalContentAlignment="Center" FontSize="14"/>
                        <Button x:Name="btnSearchByFurniture" Content="查询" FontSize="14" Padding="12,8" Margin="10,0,0,0" 
                                Background="#409EFF" Foreground="White" Cursor="Hand"
                                BorderBrush="Transparent" BorderThickness="0" Click="btnSearchByFurniture_Click" Width="70">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="Button">
                                                <Border x:Name="border"
                                                        Background="{TemplateBinding Background}"
                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                        CornerRadius="4">
                                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="border" Property="Background" Value="#66B1FF"/>
                                                        <Setter Property="Cursor" Value="Hand"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- 采购订单列表 -->
            <DataGrid x:Name="dgPurchaseOrders" AutoGenerateColumns="False" FontSize="14" 
                      CanUserAddRows="False" SelectionMode="Single" SelectionUnit="FullRow"
                      Background="White" BorderBrush="#E0E0E0" BorderThickness="1" 
                      RowHeight="45" AlternatingRowBackground="#F9F9F9"
                      GridLinesVisibility="Horizontal" HorizontalGridLinesBrush="#E0E0E0"
                      Grid.Row="1" SelectionChanged="dgPurchaseOrders_SelectionChanged">
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F5F5F5"/>
                        <Setter Property="Foreground" Value="#333333"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="BorderBrush" Value="#E0E0E0"/>
                        <Setter Property="BorderThickness" Value="0,0,0,2"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="Padding" Value="10,12"/>
                        <Setter Property="FontSize" Value="14"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <!-- 行样式 -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#E6F2FF"/>
                                <Setter Property="BorderBrush" Value="#3498DB"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="采购订单ID" Binding="{Binding PurchaseOrderId}" Width="95" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="供应商" Width="120" IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Supplier.SupplierName}" VerticalAlignment="Center" Padding="10,0"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="采购日期" Binding="{Binding PurchaseDate, StringFormat=yyyy-MM-dd}" Width="110" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="总金额" Binding="{Binding TotalAmount, StringFormat=C}" Width="110" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- 修改状态列，使用转换器 -->
                    <DataGridTextColumn Header="状态" 
                                        Binding="{Binding Status, Converter={StaticResource StatusConverter}}" 
                                        Width="90" 
                                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                        <DataGridTextColumn.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Status}" Value="pending">
                                        <Setter Property="Foreground" Value="#F39C12"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="completed">
                                        <Setter Property="Foreground" Value="#27AE60"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Status}" Value="cancelled">
                                        <Setter Property="Foreground" Value="#E74C3C"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.CellStyle>
                    </DataGridTextColumn>

                    <DataGridTextColumn Header="创建时间" Binding="{Binding CreatedAt, StringFormat=yyyy-MM-dd HH:mm}" Width="120" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <DataGridTemplateColumn Header="操作" Width="280" IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="查看明细" FontSize="12" Padding="12,6" Margin="5,0,5,0" 
                                            Background="#3498DB" Foreground="White" Cursor="Hand"
                                            BorderBrush="Transparent" BorderThickness="0" 
                                            Click="btnViewDetails_Click" Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="border"
                                                                    Background="{TemplateBinding Background}"
                                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                                    CornerRadius="3">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="#2980B9"/>
                                                                    <Setter Property="Cursor" Value="Hand"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button Content="完成订单" FontSize="12" Padding="12,6" Margin="0,0,5,0" 
                                            Background="#27AE60" Foreground="White" Cursor="Hand"
                                            BorderBrush="Transparent" BorderThickness="0" 
                                            Click="btnCompleteOrder_Click" Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="border"
                                                                    Background="{TemplateBinding Background}"
                                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                                    CornerRadius="3">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="#229954"/>
                                                                    <Setter Property="Cursor" Value="Hand"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                    <Button Content="取消订单" FontSize="12" Padding="12,6" 
                                            Background="#E74C3C" Foreground="White" Cursor="Hand"
                                            BorderBrush="Transparent" BorderThickness="0" 
                                            Click="btnCancelOrder_Click" Tag="{Binding}">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border x:Name="border"
                                                                    Background="{TemplateBinding Background}"
                                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                                    CornerRadius="3">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter TargetName="border" Property="Background" Value="#C0392B"/>
                                                                    <Setter Property="Cursor" Value="Hand"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Grid>
    </Grid>
</Page>